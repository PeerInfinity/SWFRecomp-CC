# SET_PROPERTY Test (Opcode 0x23)

This test verifies the implementation of the SET_PROPERTY opcode (0x23) in ActionScript 2.

## Opcode Details

- **Opcode**: 0x23 (SET_PROPERTY)
- **Category**: MovieClip Properties
- **SWF Version**: 4+
- **Complexity**: MEDIUM

## What This Test Does

The test sets various MovieClip properties on the _root object using numeric property indices:

1. Sets `_root._x = 100` (property index 0)
2. Sets `_root._y = 200` (property index 1)
3. Sets `_root._xscale = 50` (property index 2)
4. Sets `_root._yscale = 150` (property index 3)
5. Sets `_root._alpha = 75` (property index 6)
6. Sets `_root._rotation = 45` (property index 10)

## Expected Output

```
WASM SWF Runtime Loaded!
=== SWF Execution Started (NO_GRAPHICS mode) ===
[Frame 0]
SET_PROPERTY tests completed
[Tag] ShowFrame()
=== SWF Execution Completed ===
```

## Property Index Table

The SET_PROPERTY opcode uses numeric indices to identify properties:

| Property       | Index | Type   | Settable | Tested |
|----------------|-------|--------|----------|--------|
| _x             | 0     | Number | Yes      | ✓      |
| _y             | 1     | Number | Yes      | ✓      |
| _xscale        | 2     | Number | Yes      | ✓      |
| _yscale        | 3     | Number | Yes      | ✓      |
| _currentframe  | 4     | Number | No       |        |
| _totalframes   | 5     | Number | No       |        |
| _alpha         | 6     | Number | Yes      | ✓      |
| _visible       | 7     | Number | Yes      |        |
| _width         | 8     | Number | Yes      |        |
| _height        | 9     | Number | Yes      |        |
| _rotation      | 10    | Number | Yes      | ✓      |
| _target        | 11    | String | No       |        |
| _framesloaded  | 12    | Number | No       |        |
| _name          | 13    | String | Yes      |        |
| _droptarget    | 14    | String | No       |        |
| _url           | 15    | String | No       |        |
| _highquality   | 16    | Number | Yes      |        |
| _focusrect     | 17    | Number | Yes      |        |
| _soundbuftime  | 18    | Number | Yes      |        |
| _quality       | 19    | String | Yes      |        |
| _xmouse        | 20    | Number | No       |        |
| _ymouse        | 21    | Number | No       |        |

## Implementation Details

### Stack Operation

```
Before: [... target_path, property_index, value]
After:  [... ]
```

The opcode:
1. Pops the value to set
2. Pops the property index (0-21)
3. Pops the target path string
4. Sets the property on the target MovieClip

### Current Implementation

- Uses a static `_root` MovieClip for simplified implementation
- Supports properties: _x, _y, _xscale, _yscale, _alpha, _visible, _width, _height, _rotation, _name
- Silently ignores read-only properties (as per Flash behavior)
- Handles type conversion (string to number for numeric properties)

### Files Modified

1. `SWFRecomp/include/action/action.hpp` - Added enum
2. `SWFRecomp/src/action/action.cpp` - Added translation case
3. `SWFModernRuntime/include/actionmodern/action.h` - Added function declaration
4. `SWFModernRuntime/src/actionmodern/action.c` - Added implementation with MovieClip structure

## Building and Running

```bash
cd SWFRecomp
./scripts/build_test.sh set_property_swf_4 native
./tests/set_property_swf_4/build/native/set_property_swf_4
```

## Test Generation

The test SWF is generated by `create_test_swf.py`, which manually constructs the SWF bytecode with SET_PROPERTY operations. This approach is necessary because standard ActionScript compilers don't directly emit the SET_PROPERTY opcode for property assignments.

## Success Criteria

- ✓ Test compiles without errors
- ✓ Test runs without crashing
- ✓ All 6 property sets complete successfully
- ✓ Trace message confirms completion
- ✓ No segmentation faults or undefined behavior

## Future Enhancements

- Full target path parsing (not just "_root")
- Support for all 22 properties
- Property value validation
- Error reporting for invalid operations
- Memory management for string properties
