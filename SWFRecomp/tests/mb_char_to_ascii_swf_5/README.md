# MB_CHAR_TO_ASCII Opcode Test (0x33)

## Overview

This test verifies the implementation of the `MB_CHAR_TO_ASCII` opcode (0x33), which converts the first character of a multibyte UTF-8 string to its Unicode code point value.

## Opcode Details

- **Opcode**: 0x33
- **Name**: MB_CHAR_TO_ASCII
- **Category**: String Operations
- **SWF Version**: 5+ (multibyte support)

## Test Cases

### Test 1: Basic ASCII
- **Input**: "A"
- **Expected Output**: 65
- **Description**: Single-byte ASCII character

### Test 2: 2-byte UTF-8
- **Input**: "é" (U+00E9)
- **Expected Output**: 233
- **Description**: Latin character with diacritical mark (é = 0xC3 0xA9 in UTF-8)

### Test 3: 3-byte UTF-8 (Euro Sign)
- **Input**: "€" (U+20AC)
- **Expected Output**: 8364
- **Description**: Euro currency symbol (€ = 0xE2 0x82 0xAC in UTF-8)

### Test 4: 3-byte UTF-8 (CJK Character)
- **Input**: "中" (U+4E2D)
- **Expected Output**: 20013
- **Description**: Chinese character meaning "middle" (中 = 0xE4 0xB8 0xAD in UTF-8)

### Test 5: Empty String
- **Input**: ""
- **Expected Output**: 0
- **Description**: Edge case - empty string returns 0

## Expected Output

```
65
233
8364
20013
0
```

## Implementation Details

The opcode:
1. Pops a value from the stack and converts it to a string
2. Decodes the first UTF-8 character sequence (1-4 bytes)
3. Extracts the Unicode code point value
4. Pushes the code point as a float onto the stack

### UTF-8 Decoding

The implementation handles all UTF-8 sequence lengths:
- **1-byte** (0xxxxxxx): ASCII characters (0-127)
- **2-byte** (110xxxxx 10xxxxxx): Code points 128-2047
- **3-byte** (1110xxxx 10xxxxxx 10xxxxxx): Code points 2048-65535
- **4-byte** (11110xxx 10xxxxxx 10xxxxxx 10xxxxxx): Code points 65536-1114111

## Building and Running

```bash
# Build the test
cd SWFRecomp
./scripts/build_test.sh mb_char_to_ascii_swf_5 native

# Run the test
./tests/mb_char_to_ascii_swf_5/build/native/mb_char_to_ascii_swf_5
```

## Files

- `test.swf` - Test SWF file (generated by create_test_swf.py)
- `create_test_swf.py` - Python script to generate the test SWF
- `config.toml` - SWFRecomp configuration
- `README.md` - This file

## Related Opcodes

- `CHAR_TO_ASCII` (0x31) - Similar but for single-byte encoding (Latin-1)
- `ASCII_TO_CHAR` (0x32) - Converts ASCII/Unicode code point to character
- `MB_ASCII_TO_CHAR` (0x37) - Multibyte version of ASCII_TO_CHAR

## Notes

- Flash AS2 uses UTF-8 encoding for multibyte strings
- This opcode is the multibyte-aware version of CHAR_TO_ASCII (0x31)
- In ActionScript 2, this operation is typically accessed via `mbord(str)` or `String.charCodeAt(0)`
